
&НаКлиенте
Функция ПолучитьИОбработатьДанные(ОкноДокумента, стСтруктураКанбана, СчетчикОбращений, Сотрудник, Проект, стНастройки) Экспорт
	
	НомерВерсии = стСтруктураКанбана.СтруктураДоски.НомерВерсии;
	стРесуср = Ложь;
	
	Если СчетчикОбращений > 10 Тогда
		
		Если НЕ омКанбанДоскиНаСервере.ПолучитьНомерВерсии(стСтруктураКанбана.СтруктураДоски.УИДДоски) = НомерВерсии Тогда
			Возврат Истина;
		КонецЕсли;
		
		СчетчикОбращений = 0;
		
	Иначе
		СчетчикОбращений = СчетчикОбращений + 1;
	КонецЕсли;
		
	Если ОкноДокумента = Неопределено Тогда
		Возврат Ложь;
	КонецЕсли; 
	
	Пока ОкноДокумента.queueHead < ОкноДокумента.queueTail Цикл //Если есть что-то в очереди
		
		ОкноДокумента.queueHead = ОкноДокумента.queueHead + 1;
		Данные = ПрочитатьДанныеИзJSON(ОкноДокумента.getEvent(ОкноДокумента.queueHead));
		
		Если Данные = Неопределено Тогда
			Продолжить;	
		КонецЕсли;
		
		event = Данные.Получить("event");
		
		Если event = Неопределено Тогда
			Продолжить;	
		КонецЕсли; 
		
		Если event = "ClickItem" Тогда
			itemId = Данные.Получить("itemId");
			стРесуср = омКанбанДоскиНаСервере.ПолучитьКомментарийОбъекта(itemId);
			Продолжить;	
		КонецЕсли;
		
		Если event = "RClickItem" Тогда
			itemId = Данные.Получить("itemId");
			стРесуср = омКанбанДоскиНаСервере.ПолучитьКомментарийОбъекта(itemId);
			ОткрытьФорму("Обработка.ПередачаВЧастичныйПодряд.Форма"
				, Новый Структура("ИзделиеКомплект", стРесуср.ОбъектТЗ));
			Прервать;	
		КонецЕсли;
		
		Если event = "DbClickItem" Тогда
			
			itemId = Данные.Получить("itemId");
			
			Если НЕ itemId = Неопределено Тогда
				
				Ресуср = омКанбанДоскиНаСервере.ПолучитьСсылкуПоУИДРеквизита(itemId);
				
				Если НЕ Ресуср = Неопределено Тогда
					
					ПоказатьЗначение(, Ресуср);
					
				КонецЕсли; 
			КонецЕсли; 
			
			Продолжить;	
			
		КонецЕсли;
		
		Если event = "DropItem" Тогда
			омКанбанДоскиНаСервере.ЗаписатПереход(Данные, стСтруктураКанбана.СтруктураДоски.УИДДоски);
			Возврат Истина;
		КонецЕсли;
		
		СчетчикОбращений = 0;
		
		Возврат Ложь;
		
	КонецЦикла;
	
	Возврат стРесуср;
	
КонецФункции

&НаКлиенте
Функция ПрочитатьДанныеИзJSON(СтрокаJSON)
	Результат = ПрочитатьСтрокуJSON(СтрокаJSON);
	Если ТипЗнч(Результат) = Тип("Строка") Тогда
		Возврат ПрочитатьСтрокуJSON(Результат);
	Иначе
		Возврат Результат;
	КонецЕсли; 
КонецФункции

&НаКлиенте
Функция ПрочитатьСтрокуJSON(СтрокаJSON) Экспорт
	
	Результат = Неопределено;
	
	Попытка
		ЧтениеJSON = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(СтрокаJSON);
		Результат = ПрочитатьJSON(ЧтениеJSON, Истина);
	Исключение
		Возврат Неопределено;
	КонецПопытки;
	
	Возврат Результат;
КонецФункции


